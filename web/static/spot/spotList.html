<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Untree.co">
  <link rel="shortcut icon" href="../favicon.png">

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap4" />

  <!-- Bootstrap CSS -->
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="../css/tiny-slider.css" rel="stylesheet">
  <link href="../css/style.css" rel="stylesheet">

  <script src="/static/auth/auth.js"></script>
  <script src="/static/nav/navbar.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <title>Furni Free Bootstrap 5 Template for Furniture and Interior Design Websites by Untree.co</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .header-buttons {
        display: flex;
        justify-content: center;
        margin: 20px 0 20px;
    }

    .header-buttons select {
        padding: 10px 20px; /* 세로 패딩과 가로 패딩 조정 */
        border: none;
        border-radius: 5px;
        cursor: pointer;
        color: white;
        font-size: 16px; /* 버튼 텍스트 크기 조정 */
        box-sizing: border-box; /* Padding과 border를 포함한 크기 조정 */
        background-color: #c0c0c0; /* 배경색 */
        width: 700px; /* 드롭다운 너비 설정 */
        margin: 0 5px; /* 드롭다운 사이에 간격 추가 */
    }

    #searchContainer {
        display: none; /* 기본적으로 숨김 */
        margin-top: 10px;
        padding-right: 300px;
        padding-left: 300px;
        box-sizing: border-box;
        display: flex; /* Flexbox를 사용하여 수평 정렬 */
        align-items: center; /* 수직 중앙 정렬 */
        gap: 10px; /* 입력 필드와 버튼 사이의 간격 */
    }

    #searchInput {
        width: calc(100% - 60px); /* 너비 조정 (필요에 따라 수정) */
        padding: 10px 20px; /* 위아래 패딩: 10px, 좌우 패딩: 20px */
        border-radius: 5px;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }

    /* 추가된 카드 스타일 */
    .facility-cards {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 카드 3개씩 한 줄에 배치 */
        gap: 20px;
        padding: 20px;
    }

    .facility-card {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        padding: 20px;
        text-align: center;
        cursor: pointer; /* 마우스를 올렸을 때 클릭 가능하게 변경 */
    }

    .facility-card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 5px;
        margin-bottom: 15px;
    }

    .facility-card .status {
        font-size: 1em;
        font-weight: bold;
        color: #28a745; /* 상태 색상 (예: 운영중 - 녹색) */
        margin-bottom: 10px;
    }

    .facility-card .name {
        font-size: 1.2em;
        margin-bottom: 10px;
    }

    .facility-card .hours {
        font-size: 0.9em;
        color: #777;
    }

    .facility-section {
      padding-left: 150px; /* 원하는 왼쪽 패딩 값을 지정하세요 */
      padding-right: 150px; /* 원하는 오른쪽 패딩 값을 지정하세요 */
    }

    .pagination {
        display: flex;
        justify-content: center;
        margin: 20px 0;
    }

    .pagination button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        background-color: #c0c0c0;
        color: white;
        cursor: pointer;
        margin: 0 5px;
    }

    .pagination span {
        padding: 10px 20px;
        font-size: 16px;
    }

    /* 반응형 */
    @media (max-width: 768px) {
        .facility-cards {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 576px) {
        .facility-cards {
            grid-template-columns: 1fr;
        }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
</head>

<body>
<div id="navbar-placeholder"></div>

<script>
  $(document).ready(function(){
    $("#navbar-placeholder").load("/static/nav/navbar.html", function() {
      console.log("Navbar loaded");
      if (typeof setupNavbar === 'function') {
        setupNavbar();
      } else {
        console.error('setupNavbar function is not defined');
      }
    });
  });
</script>

  <!-- Start Hero Section -->
  <div class="hero">
    <div class="container">
      <div class="row justify-content-between">
        <div class="col-lg-5">
          <div class="intro-excerpt">
            <h1>시설정보 및 예약</h1>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search and Facility Type Dropdowns -->
  <header>
    <div class="header-buttons">
      <select id="facilityDropdown">
        <option value="" disabled selected>종목명 선택</option>
        <option value="수영장">수영장</option>
        <option value="야구장">야구장</option>
        <option value="축구장">축구장</option>
        <option value="테니스장">테니스장</option>
        <option value="농구장">농구장</option>
        <option value="골프연습장">골프연습장</option>
        <option value="족구장">족구장</option>
        <option value="배드민턴장">배드민턴장</option>
        <option value="풋살장">풋살장</option>
        <option value="게이트볼장">게이트볼장</option>
        <option value="배구장">배구장</option>
        <option value="빙상장">빙상장</option>
      </select>
      <select id="searchDropdown">
        <option value="" disabled selected>지역 선택</option>
        <option value="강남">강남</option>
        <option value="강동">강동</option>
        <option value="강북">강북</option>
        <option value="강서">강서</option>
        <option value="관악">관악</option>
        <option value="광진">광진</option>
        <option value="구로">구로</option>
        <option value="금천">금천</option>
        <option value="노원">노원</option>
        <option value="도봉">도봉</option>
        <option value="동대문">동대문</option>
        <option value="동작">동작</option>
        <option value="마포">마포</option>
        <option value="서대문">서대문</option>
        <option value="서초">서초</option>
        <option value="성동">성동</option>
        <option value="성북">성북</option>
        <option value="송파">송파</option>
        <option value="양천">양천</option>
        <option value="영등포">영등포</option>
        <option value="용산">용산</option>
        <option value="은평">은평</option>
        <option value="종로">종로</option>
        <option value="중구">중구</option>
        <option value="중랑">중랑</option>


      </select>
    </div>
  </header>

  <!-- Facility Cards Section -->
  <section class="facility-section">
    <div id="facilityCards" class="facility-cards">
      <!-- Facility cards will be dynamically inserted here -->
    </div>
    <div class="pagination">
      <button id="prevPage">Previous</button>
      <span id="pageNumbers">Page 1 of 2</span>
      <button id="nextPage">Next</button>
    </div>
  </section>
  <!-- End Facility Cards Section -->

</div>
</div>
</footer>
<!-- End Footer Section -->

<!-- JavaScript to handle dropdown selections and pagination -->
<script>
  // API 엔드포인트 설정
  const API_BASE_URL_SPOT = 'http://localhost:8080/api/v1/spots';
  const API_BASE_URL_IMAGE = 'http://localhost:8080/api/v1/spot/image';

  // 페이지네이션 변수
  let currentPage = 1;
  const cardsPerPage = 9;
  let totalPages = 1;
  let allFacilities = [];

  // DOM 요소
  const facilityCardsContainer = document.getElementById('facilityCards');
  const prevPageBtn = document.getElementById('prevPage');
  const nextPageBtn = document.getElementById('nextPage');
  const pageNumbers = document.getElementById('pageNumbers');
  const facilityDropdown = document.getElementById('facilityDropdown');
  const searchDropdown = document.getElementById('searchDropdown');

  // 페이지 로드 시 시설 정보 가져오기
  document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM 로드 완료, fetchAllSpots 호출');
    fetchAllSpots();
  });

  // 모든 시설 정보 가져오기
  async function fetchAllSpots() {
    try {
      console.log('모든 시설 정보 가져오기 시작');
      const response = await axios.get(API_BASE_URL_SPOT);
      console.log('받은 시설 정보:', response.data);
      allFacilities = response.data;
      totalPages = Math.ceil(allFacilities.length / cardsPerPage);
      console.log(`총 ${allFacilities.length}개의 시설, ${totalPages} 페이지`);
      renderFacilityCards(currentPage);
    } catch (error) {
      console.error('시설 정보를 불러오는 데 실패했습니다:', error);
      alert('시설 정보를 불러오는 데 실패했습니다. 나중에 다시 시도해 주세요.');
    }
  }

  // 시설 카드 렌더링
  async function renderFacilityCards(page) {
    console.log(`${page} 페이지 시설 카드 렌더링 시작`);
    const start = (page - 1) * cardsPerPage;
    const end = start + cardsPerPage;
    const paginatedData = allFacilities.slice(start, end);

    facilityCardsContainer.innerHTML = '';

    for (const facility of paginatedData) {
      try {
        const sportsType = mapSportsTypeToImageType(facility.sportsType);
        console.log(`${facility.name}의 이미지 URL 요청 중 (${sportsType})`);
        const response = await axios.get(`${API_BASE_URL_IMAGE}/${sportsType}`);
        let imageUrl = response.data.image;
        console.log('받은 이미지 URL:', imageUrl);

        imageUrl = imageUrl.replace('/web', '');
        const fullImageUrl = `http://localhost:8080${imageUrl}`;
        console.log('최종 이미지 URL:', fullImageUrl);

        const facilityCard = document.createElement('div');
        facilityCard.classList.add('facility-card');
        facilityCard.innerHTML = `
          <img src="${fullImageUrl}" alt="${facility.name}" loading="lazy">
          <div class="status">${facility.status || '정보 없음'}</div>
          <div class="name">${facility.name}</div>
          <div class="hours">${facility.weekdayHours || '정보 없음'}</div>
        `;

        facilityCard.addEventListener('click', () => {
          window.location.href = `/static/spot/spotDetail.html?id=${facility.id}`;
        });

        facilityCardsContainer.appendChild(facilityCard);
      } catch (error) {
        console.error(`이미지 정보를 불러오는 데 실패했습니다: ${facility.name}`, error);
      }
    }

    pageNumbers.textContent = `Page ${page} of ${totalPages}`;
    console.log(`${page} 페이지 시설 카드 렌더링 완료`);
  }

  function mapSportsTypeToImageType(sportsType) {
    switch (sportsType) {
      case "수영장": return "swimming";
      case "야구장": return "baseball";
      case "축구장": return "soccer";
      case "테니스장": return "tennis";
      case "농구장": return "basketball";
      case "골프연습장": return "golf";
      case "족구장": return "jokgu";
      case "배드민턴장": return "badminton";
      case "풋살장": return "futsal";
      case "게이트볼장": return "gateball";
      case "배구장": return "volleyball";
      case "빙상장": return "ice";
      default: return "default";
    }
  }

  // 이전 페이지 버튼
  prevPageBtn.addEventListener('click', () => {
    if (currentPage > 1) {
      currentPage--;
      console.log(`이전 페이지 버튼 클릭, 현재 페이지: ${currentPage}`);
      renderFacilityCards(currentPage);
    }
  });

  // 다음 페이지 버튼
  nextPageBtn.addEventListener('click', () => {
    if (currentPage < totalPages) {
      currentPage++;
      console.log(`다음 페이지 버튼 클릭, 현재 페이지: ${currentPage}`);
      renderFacilityCards(currentPage);
    }
  });

  // 지역과 스포츠 종목을 동시에 필터링하는 함수
  async function fetchSpotsByRegionAndSportsType(regionType, sportsType) {
    try {
      console.log(`지역 및 스포츠 종목 필터링: 지역 - ${regionType}, 종목 - ${sportsType}`);
      const encodedRegionType = encodeURIComponent(regionType);
      const encodedSportsType = encodeURIComponent(sportsType);
      const url = `${API_BASE_URL_SPOT}/filter?region=${encodedRegionType}&sports=${encodedSportsType}`;
      console.log('요청 URL:', url);

      const response = await axios.get(url);
      console.log('서버 응답:', response);
      console.log('필터링된 시설 정보:', response.data);

      allFacilities = response.data;
      currentPage = 1;
      totalPages = Math.ceil(allFacilities.length / cardsPerPage);
      console.log(`필터링 결과: ${allFacilities.length}개의 시설, ${totalPages} 페이지`);
      renderFacilityCards(currentPage);
    } catch (error) {
      console.error('시설 정보를 불러오는 데 실패했습니다:', error);
      if (error.response) {
        console.error('Error status:', error.response.status);
        console.error('Error data:', error.response.data);
      }
      alert('시설 정보를 불러오는 데 실패했습니다. 서버 응답을 확인해 주세요.');
    }
  }

  // 필터 처리 함수
  function handleFilters() {
    const sportsType = facilityDropdown.value;
    const regionType = searchDropdown.value;
    console.log(`필터 처리: 지역 - ${regionType}, 종목 - ${sportsType}`);

    if (sportsType && regionType) {
      fetchSpotsByRegionAndSportsType(regionType, sportsType);
    } else if (sportsType) {
      console.log(`종목별 필터링: ${sportsType}`);
      const encodedSportsType = encodeURIComponent(sportsType);
      axios.get(`${API_BASE_URL_SPOT}/sports/${encodedSportsType}`)
              .then(response => {
                console.log('종목별 필터링 결과:', response.data);
                allFacilities = response.data;
                currentPage = 1;
                totalPages = Math.ceil(allFacilities.length / cardsPerPage);
                renderFacilityCards(currentPage);
              })
              .catch(error => {
                console.error('종목별 시설 정보를 불러오는 데 실패했습니다:', error);
                if (error.response) {
                  console.error('Error response:', error.response.data);
                }
                alert('종목별 시설 정보를 불러오는 데 실패했습니다. 서버 응답을 확인해 주세요.');
              });
    } else if (regionType) {
      console.log(`지역별 필터링: ${regionType}`);
      const encodedRegionType = encodeURIComponent(regionType);
      axios.get(`${API_BASE_URL_SPOT}/region/${encodedRegionType}`)
              .then(response => {
                console.log('지역별 필터링 결과:', response.data);
                allFacilities = response.data;
                currentPage = 1;
                totalPages = Math.ceil(allFacilities.length / cardsPerPage);
                renderFacilityCards(currentPage);
              })
              .catch(error => {
                console.error('지역별 시설 정보를 불러오는 데 실패했습니다:', error);
                if (error.response) {
                  console.error('Error response:', error.response.data);
                }
                alert('지역별 시설 정보를 불러오는 데 실패했습니다. 서버 응답을 확인해 주세요.');
              });
    } else {
      console.log('모든 필터 해제, 전체 시설 정보 불러오기');
      fetchAllSpots();
    }
  }

  // 이벤트 리스너 설정
  facilityDropdown.addEventListener('change', handleFilters);
  searchDropdown.addEventListener('change', handleFilters);

  // 시설 상세 정보 페이지로 이동
  function navigateToSpotDetail(spotId) {
    console.log(`시설 상세 정보 페이지로 이동: ID ${spotId}`);
    window.location.href = `/static/spot/spotDetail.html?id=${spotId}`;
  }
</script>
<!-- End Hero Section -->

      <!-- Start Footer Section -->
      <footer class="footer-section">
        <div class="container relative">
           <div class="row g-5 mb-5">
             <div class="col-lg-4">
               <div class="mb-4 footer-logo-wrap"><a href="#" class="footer-logo">Sports Spot<span>.</span></a></div>
               <p class="mb-4">National Public Sports Facility Information Comprehensive Service</p>

               <ul class="list-unstyled custom-social">
                 <li><a href="#"><span class="fa fa-brands fa-facebook-f"></span></a></li>
                 <li><a href="#"><span class="fa fa-brands fa-twitter"></span></a></li>
                 <li><a href="#"><span class="fa fa-brands fa-instagram"></span></a></li>
                 <li><a href="#"><span class="fa fa-brands fa-linkedin"></span></a></li>
               </ul>
             </div>

             <div class="col-lg-8">
               <div class="row links-wrap">
                 <div class="col-6 col-sm-6 col-md-3">
                    <ul class="list-unstyled">
                      <li><a href="#">About us</a></li>
                      <li><a href="#">Services</a></li>
                      <li><a href="#">Blog</a></li>
                      <li><a href="#">Contact us</a></li>
                    </ul>
                 </div>

                 <div class="col-6 col-sm-6 col-md-3">
                    <ul class="list-unstyled">
                      <li><a href="#">Support</a></li>
                      <li><a href="#">Knowledge base</a></li>
                      <li><a href="#">Live chat</a></li>
                    </ul>
                 </div>

                 <div class="col-6 col-sm-6 col-md-3">
                    <ul class="list-unstyled">
                      <li><a href="#">Jobs</a></li>
                      <li><a href="#">Our team</a></li>
                      <li><a href="#">Leadership</a></li>
                      <li><a href="#">Privacy Policy</a></li>
                    </ul>
                 </div>

                 <div class="col-6 col-sm-6 col-md-3">
                    <ul class="list-unstyled">
                      <li><a href="#">Nordic Chair</a></li>
                      <li><a href="#">Kruzo Aero</a></li>
                      <li><a href="#">Ergonomic Chair</a></li>
                    </ul>
                 </div>
               </div>
             </div>
           </div>

           <div class="border-top copyright">
             <div class="row pt-4">
               <div class="col-lg-6">
                 <p class="mb-2 text-center text-lg-start">Copyright &copy;<script>document.write(new Date().getFullYear());</script>. All Rights Reserved. &mdash; Designed with love by <a href="https://untree.co">Untree.co</a> Distributed By <a hreff="https://themewagon.com">ThemeWagon</a>  <!-- License information: https://untree.co/license/ -->
           </p>
               </div>

               <div class="col-lg-6 text-center text-lg-end">
                 <ul class="list-unstyled d-inline-flex ms-auto">
                    <li class="me-4"><a href="#">Terms &amp; Conditions</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                 </ul>
               </div>
             </div>
           </div>
        </div>
      </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<!-- JavaScript Files -->
<script src="../js/bootstrap.bundle.min.js"></script>
<script src="../js/tiny-slider.js"></script>
<script src="../js/custom.js"></script>

</body>
</html>